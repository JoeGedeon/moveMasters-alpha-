<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MoveMasters OS | Titan X-110 Absolute</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/11.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.1.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        :root { --bg: #000; --sidebar: #050505; --accent: #3b82f6; --card: #0a0a0a; --gold: #f59e0b; --green: #22c55e; }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: #fff; 
            margin: 0; display: flex; height: 100dvh; width: 100vw; overflow: hidden;
        }

        /* --- INDESTRUCTIBLE SIDEBAR --- */
        .sidebar { width: 260px; background: var(--sidebar); border-right: 2px solid #fff; flex-shrink: 0; display: flex; flex-direction: column; z-index: 1000; overflow-y: auto; }
        .nav-btn {
            display: flex; align-items: center; gap: 12px; padding: 22px 24px; font-size: 11px; font-weight: 800; color: #444; 
            cursor: pointer; transition: 0.2s; border-bottom: 1px solid rgba(255,255,255,0.05); text-transform: uppercase; letter-spacing: 0.15em;
        }
        .nav-btn[data-active="true"] {
            background: rgba(59, 130, 246, 0.2) !important; color: #fff !important;
            border-left: 12px solid var(--accent) !important; box-shadow: inset 30px 0 50px -20px rgba(59,130,246,0.8) !important;
        }

        /* --- MAIN CONSOLE --- */
        .main-stage { flex-grow: 1; height: 100vh; overflow-y: auto; padding: 40px; position: relative; -webkit-overflow-scrolling: touch; }
        .titan-title { font-size: 40px; font-weight: 900; font-style: italic; text-transform: uppercase; text-align: center; margin-bottom: 30px; }
        .titan-gradient { background: linear-gradient(to right, #fff, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* --- CARD ARCHITECTURE --- */
        .node-card {
            background: var(--card); border: 2.5px solid #fff; border-radius: 30px; padding: 45px; margin-bottom: 25px;
            display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; position: relative; min-height: 280px;
        }
        .node-label {
            font-size: 9px; font-weight: 800; text-transform: uppercase; color: #000; background: #fff; padding: 6px 16px; 
            border-radius: 6px; position: absolute; top: 25px; left: 50%; transform: translateX(-50%); letter-spacing: 0.2em;
        }

        input, select, textarea { background: #000 !important; border: 1.5px solid #fff !important; padding: 18px; border-radius: 12px; width: 100%; color: #fff !important; font-weight: 700; text-align: center; outline: none; }
        
        /* --- CALENDAR --- */
        .calendar-table { width: 100%; border-spacing: 8px; border-collapse: separate; table-layout: fixed; }
        .calendar-table th { font-size: 10px; font-weight: 900; text-transform: uppercase; padding: 10px; }
        .date-tile { background: #000; border: 1px solid rgba(255,255,255,0.1); border-radius: 14px; height: 120px; padding: 8px; vertical-align: top; cursor: pointer; overflow: hidden; position: relative; }
        .date-tile:hover { border-color: #fff; }
        .date-tile[data-selected="true"] { border: 3px solid var(--accent); background: rgba(59,130,246,0.1); }
        .job-pill { background: #fff; color: #000; font-size: 8px; font-weight: 900; padding: 5px; border-radius: 6px; margin-top: 4px; display: block; border-left: 4px solid var(--accent); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* --- MATRIX --- */
        .inventory-scroll { width: 100%; max-height: 450px; overflow-y: auto; display: grid; grid-template-cols: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .item-counter { background: rgba(255,255,255,0.03); border: 1.5px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 15px; display: flex; align-items: center; justify-content: space-between; }
        .qty-btn { width: 35px; height: 35px; border-radius: 8px; border: 1.5px solid rgba(255,255,255,0.2); color: #fff; font-weight: 900; cursor: pointer; }
        
        /* --- UTILS --- */
        #toast-msg { position: fixed; bottom: 40px; right: 40px; background: #fff; color: #000; padding: 22px 45px; border-radius: 24px; font-weight: 900; z-index: 9999; transform: translateY(200%); transition: 0.4s; }
        #toast-msg.show { transform: translateY(0); }
        .hidden { display: none !important; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.98); backdrop-filter: blur(30px); z-index: 5000; overflow-y: auto; padding: 40px; }
        #neural-loader { position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 6000; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 30px; }
    </style>
</head>
<body>

    <div id="toast-msg">DATA SYNCHRONIZED</div>

    <aside class="sidebar">
        <div class="sidebar-header"><h2 class="text-lg font-black uppercase italic">MoveMasters</h2></div>
        <div id="sidebar-nav" class="flex-grow">
            <div class="nav-btn" onclick="switchTab('Dashboard')" id="btn-Dashboard" data-active="true">Dashboard</div>
            <div class="nav-btn" onclick="switchTab('LeadMagnet')" id="btn-LeadMagnet" style="color:var(--gold)">★ Lead Magnet</div>
            <div class="nav-btn" onclick="switchTab('CustomerList')" id="btn-CustomerList">Customer List</div>
            <div class="nav-btn" onclick="switchTab('CRM')" id="btn-CRM">CRM Database</div>
            <div class="nav-btn" onclick="switchTab('CrewHub')" id="btn-CrewHub">Crew Hub</div>
            <div class="nav-btn" onclick="switchTab('FleetMaster')" id="btn-FleetMaster">Fleet Master</div>
            <div class="nav-btn" onclick="switchTab('Inventory')" id="btn-Inventory">Inventory</div>
            <div class="nav-btn" onclick="switchTab('Financials')" id="btn-Financials">Financials</div>
        </div>
    </aside>

    <main class="main-stage">
        <h1 id="view-title" class="titan-title titan-gradient">Dashboard</h1>

        <!-- VIEW: DASHBOARD -->
        <div id="DashboardView" class="view-panel">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <div class="lg:col-span-3">
                    <div class="node-card !min-height-0 !p-8">
                        <div class="flex justify-between w-full mb-6">
                            <h3 id="month-label" class="text-2xl font-black uppercase italic">December 2025</h3>
                            <div class="flex gap-2"><button onclick="changeMonth(-1)" class="px-4 py-2 border border-white rounded-lg">◀</button><button onclick="changeMonth(1)" class="px-4 py-2 border border-white rounded-lg">▶</button></div>
                        </div>
                        <table class="calendar-table"><tbody id="calendar-body"></tbody></table>
                    </div>
                    <div class="grid grid-cols-2 gap-8 mt-8">
                        <div class="node-card"><span class="node-label">Revenue Sync</span><div class="stat-value text-5xl font-black italic" id="stat-rev">$0</div></div>
                        <div class="node-card"><span class="node-label">Lead Pipeline</span><div class="stat-value text-5xl font-black italic" id="stat-leads">0</div></div>
                    </div>
                </div>
                <div class="node-card h-fit sticky top-0 !min-height-0"><span class="node-label">Daily Manifest</span><div id="day-jobs-list" class="w-full space-y-4"></div></div>
            </div>
        </div>

        <!-- VIEW: CUSTOMER LIST (ABSOLUTE INTAKE) -->
        <div id="CustomerListView" class="view-panel hidden pb-40">
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
                <div class="node-card"><span class="node-label">01 // Identity</span>
                    <input type="text" placeholder="Full Name" oninput="saveDraft('name', this.value)" id="cap-name">
                    <input type="tel" placeholder="Primary (000) 000-0000" class="phone-mask" oninput="saveDraft('phone', this.value)" id="cap-phone">
                    <input type="tel" placeholder="Secondary Phone" class="phone-mask" oninput="saveDraft('phone2', this.value)" id="cap-phone2">
                    <input type="email" placeholder="Email" oninput="saveDraft('email', this.value)" id="cap-email">
                </div>
                <div class="node-card"><span class="node-label">02 // Pickup</span>
                    <input type="text" placeholder="Street" oninput="saveDraft('pStreet', this.value)" id="cap-pStreet">
                    <div class="grid grid-cols-3 gap-2"><input type="text" placeholder="City" id="cap-pCity"><input type="text" placeholder="ST" id="cap-pST"><input type="tel" placeholder="Zip" id="cap-pZip" maxlength="5"></div>
                    <select id="cap-pType"><option>House</option><option>Apartment</option><option>Storage</option></select>
                </div>
                <div class="node-card"><span class="node-label">03 // Delivery</span>
                    <input type="text" placeholder="Street" oninput="saveDraft('dStreet', this.value)" id="cap-dStreet">
                    <div class="grid grid-cols-3 gap-2"><input type="text" placeholder="City" id="cap-dCity"><input type="text" placeholder="ST" id="cap-dST"><input type="tel" placeholder="Zip" id="cap-dZip" maxlength="5"></div>
                    <button onclick="handleSynchronize()" class="w-full py-4 mt-4 bg-white text-black font-black uppercase rounded-xl shadow-xl">⚡ Sync Mission</button>
                </div>
            </div>
            <div class="node-card mt-8 overflow-hidden">
                <span class="node-label">04 // Vision Auditor & Matrix</span>
                <div id="neural-loader" class="hidden"><div class="w-12 h-12 border-4 border-blue-500 border-t-transparent animate-spin rounded-full"></div></div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 w-full mt-12">
                    <div class="space-y-6">
                        <textarea id="cap-notes" rows="10" placeholder="LOG SITE INTELLIGENCE..." oninput="saveDraft('notes', this.value)"></textarea>
                        <div id="photo-gallery" class="grid grid-cols-4 gap-2">
                            <div class="aspect-square border-2 border-dashed border-white/20 rounded-xl flex items-center justify-center relative"><span class="text-[9px] font-black">SNAP</span><input type="file" multiple accept="image/*" class="absolute inset-0 opacity-0" onchange="handlePhotos(this)"></div>
                        </div>
                        <button onclick="runNeuralAudit()" class="w-full py-5 bg-blue-600 rounded-2xl font-black uppercase shadow-lg shadow-blue-900/40">Run AI Inventory Audit</button>
                    </div>
                    <div>
                        <div class="text-7xl font-black italic text-blue-500" id="calc-tally">0 ft³</div>
                        <div class="flex gap-2 my-4"><input type="text" id="cust-item-name" placeholder="Item Name" class="!p-2 !text-xs"><input type="number" id="cust-item-vol" placeholder="ft³" class="!p-2 !text-xs !w-20"><button onclick="addCustomItem()" class="bg-blue-600 px-4 rounded-lg">+</button></div>
                        <div id="inventory-grid" class="inventory-scroll custom-scrollbar"></div>
                        <input type="number" id="cap-vol" placeholder="Final cubic" class="mt-8 text-3xl font-black py-6">
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: MAGNET -->
        <div id="LeadMagnetView" class="view-panel hidden">
            <div class="node-card">
                <span class="node-label">Lead Magnet Node</span>
                <h4 class="text-3xl font-black italic uppercase">Conversion Portal Operational</h4>
                <p class="text-zinc-500 mt-4">Consumer-facing survey engine synchronized.</p>
            </div>
        </div>

        <!-- VIEW: CRM -->
        <div id="CRMView" class="view-panel hidden">
            <div class="node-card !min-height-0 relative"><span class="node-label">Mission Archive</span><div id="crm-body" class="w-full mt-12 divide-y divide-white/5"></div></div>
        </div>

    </main>

    <!-- MASTER EDITOR MODAL -->
    <div id="editor-modal" class="modal-overlay hidden">
        <div class="max-w-4xl mx-auto node-card !border-blue-600">
            <div class="flex justify-between w-full mb-10"><h2 class="text-4xl font-black italic">COMMAND OVERRIDE</h2><button onclick="closeEditor()" class="text-2xl">✕</button></div>
            <div id="editor-content" class="w-full space-y-6"></div>
            <button onclick="saveJobChanges()" class="w-full py-6 mt-10 bg-blue-600 rounded-3xl font-black uppercase italic shadow-2xl">Deploy Mission Update</button>
        </div>
    </div>

    <script>
        const apiKey = ""; // env
        let state = {
            activeTab: 'Dashboard', customers: [], curMonth: new Date(2025, 11, 1), selDate: '2025-12-22',
            images: [], inventory: {}, draft: {}, matrix: [
                {cat:'Room', name:'King Bed', vol:60}, {cat:'Room', name:'Queen Bed', vol:50}, {cat:'Room', name:'Dresser', vol:25},
                {cat:'Living', name:'Sofa (3-Seat)', vol:50}, {cat:'Living', name:'Sectional', vol:30}, {cat:'Living', name:'Armchair', vol:12},
                {cat:'Kitchen', name:'Fridge', vol:60}, {cat:'Boxes', name:'Small Box', vol:1.5}, {cat:'Boxes', name:'Medium Box', vol:3}
            ]
        };

        // --- PRECISION MASKING ---
        function maskPhone(v) {
            let n = v.replace(/\D/g,'');
            if(n.length < 4) return n;
            if(n.length < 7) return `(${n.slice(0,3)}) ${n.slice(3)}`;
            return `(${n.slice(0,3)}) ${n.slice(3,6)}-${n.slice(6,10)}`;
        }
        window.addEventListener('input', e => { if(e.target.classList.contains('phone-mask')) e.target.value = maskPhone(e.target.value); });

        // --- SOVEREIGN NAVIGATION ---
        window.switchTab = (id) => {
            state.activeTab = id;
            document.querySelectorAll('.nav-btn').forEach(b => b.setAttribute('data-active', b.id === 'btn-'+id));
            document.querySelectorAll('.view-panel').forEach(p => p.classList.add('hidden'));
            const panel = document.getElementById(id+'View');
            if(panel) panel.classList.remove('hidden');
            document.getElementById('view-title').innerText = id.replace(/([A-Z])/g, ' $1').trim();
            if(id === 'Dashboard') renderCalendar();
            if(id === 'CustomerList') renderMatrix();
            if(id === 'CRM') renderCRM();
        };

        // --- CALENDAR ENGINE ---
        window.renderCalendar = () => {
            const body = document.getElementById('calendar-body');
            const month = state.curMonth.getMonth(); const year = state.curMonth.getFullYear();
            const first = new Date(year, month, 1).getDay(); const days = new Date(year, month+1, 0).getDate();
            document.getElementById('month-label').innerText = new Intl.DateTimeFormat('en-US',{month:'long',year:'numeric'}).format(state.curMonth);
            body.innerHTML = ''; let date = 1;
            for(let i=0; i<6; i++) {
                let row = document.createElement('tr');
                for(let j=0; j<7; j++) {
                    let cell = document.createElement('td');
                    if(i===0 && j<first || date > days) { cell.innerHTML = '<div></div>'; }
                    else {
                        const dk = `${year}-${String(month+1).padStart(2,'0')}-${String(date).padStart(2,'0')}`;
                        const jobs = state.customers.filter(c => c.date === dk);
                        cell.innerHTML = `<div class="date-tile" data-selected="${state.selDate===dk}" onclick="focusDay('${dk}')"><span class="text-[10px] font-black">${date}</span><div class="mt-1">${jobs.map(j => `<div class="job-pill" onclick="event.stopPropagation(); openEditor('${j.id}')">${j.name.split(' ')[0]}</div>`).join('')}</div></div>`;
                        date++;
                    }
                    row.appendChild(cell);
                }
                body.appendChild(row); if(date > days) break;
            }
            updateStats();
        };

        window.focusDay = (d) => { state.selDate = d; renderCalendar(); 
            const jobs = state.customers.filter(c => c.date === d);
            document.getElementById('day-jobs-list').innerHTML = jobs.length ? jobs.map(j => `<div onclick="openEditor('${j.id}')" class="p-5 bg-zinc-900 border border-white/10 rounded-2xl text-center cursor-pointer hover:border-blue-500"><p class="font-black italic text-white">${j.name}</p><p class="text-[9px] uppercase text-zinc-500 mt-1">${j.time} // ${j.vol} FT³</p></div>`).join('') : `<div class="py-10 text-center opacity-10 uppercase text-xs">Void</div>`;
        };

        // --- LOGISTICS ENGINE ---
        window.renderMatrix = () => {
            const grid = document.getElementById('inventory-grid'); if(!grid) return;
            grid.innerHTML = state.matrix.map(i => `<div class="item-counter"><div><p class="text-[10px] font-black uppercase">${i.name}</p><input type="number" value="${i.vol}" class="!p-0 !bg-transparent !border-none !w-8 !text-[9px] !text-blue-500" onchange="updateItemVol('${i.name}',this.value)"></div><div class="flex items-center gap-3"><button class="qty-btn" onclick="updateQty('${i.name}',-1)">-</button><span class="text-lg font-black text-blue-400">${state.inventory[i.name]||0}</span><button class="qty-btn" onclick="updateQty('${i.name}',1)">+</button></div></div>`).join('');
            calcTally();
        };
        window.updateQty = (n,d) => { state.inventory[n] = Math.max(0, (state.inventory[n]||0)+d); renderMatrix(); };
        window.updateItemVol = (n,v) => { const i = state.matrix.find(x=>x.name===n); if(i) i.vol = parseInt(v)||0; calcTally(); };
        function calcTally() { let t = 0; state.matrix.forEach(i => t += (state.inventory[i.name]||0)*i.vol); document.getElementById('calc-tally').innerText = t.toFixed(1) + ' ft³'; return t; }
        window.applyCalcToLoad = () => { let t = calcTally(); document.getElementById('cap-vol').value = Math.ceil(t); };
        window.addCustomItem = () => { const n = document.getElementById('cust-item-name').value; const v = parseInt(document.getElementById('cust-item-vol').value); if(n && v) { state.matrix.unshift({cat:'Custom', name:n, vol:v}); renderMatrix(); } };

        // --- QUANTUM AI AUDITOR ---
        async function runNeuralAudit() {
            if(!state.images.length) return showToast("NO PHOTOS");
            const loader = document.getElementById('neural-loader'); loader.classList.remove('hidden');
            const compressed = await Promise.all(state.images.slice(-3).map(b => new Promise(r => { const i = new Image(); i.onload = () => { const c = document.createElement('canvas'); const s = Math.min(1, 640/Math.max(i.width,i.height)); c.width = i.width*s; c.height = i.height*s; c.getContext('2d').drawImage(i,0,0,c.width,c.height); r(c.toDataURL('image/jpeg',0.5).split(',')[1]); }; i.src = b; })));
            const prompt = `Identify furniture. Map to: ${state.matrix.map(i=>i.name).join(',')}. Return JSON {"items":{"Name":count}, "total_vol":number}.`;
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({contents:[{parts:[{text:prompt}, ...compressed.map(d=>({inlineData:{mimeType:"image/jpeg",data:d}}))]}]}) });
                const json = JSON.parse((await res.json()).candidates[0].content.parts[0].text.replace(/```json|```/g,''));
                Object.entries(json.items).forEach(([k,v]) => { if(state.matrix.find(x=>x.name===k)) state.inventory[k] = (state.inventory[k]||0)+v; });
                document.getElementById('cap-vol').value = Math.ceil(json.total_vol); renderMatrix(); showToast("AI AUDIT COMPLETE");
            } catch(e) { showToast("NEURAL DELAY"); } finally { loader.classList.add('hidden'); }
        }

        // --- MASTER COMMAND ---
        window.openEditor = (id) => {
            const j = state.customers.find(x => x.id === id); if(!j) return;
            state.activeJobId = id;
            document.getElementById('editor-content').innerHTML = `
                <input type="text" id="ed-name" value="${j.name}"><input type="tel" id="ed-phone" value="${j.phone}" class="phone-mask">
                <textarea id="ed-notes" rows="6" class="!text-left">${j.notes||''}</textarea><input type="number" id="ed-vol" value="${j.vol}">
            `;
            document.getElementById('editor-modal').classList.remove('hidden');
        };
        window.closeEditor = () => document.getElementById('editor-modal').classList.add('hidden');
        window.saveJobChanges = () => {
            const i = state.customers.findIndex(x => x.id === state.activeJobId);
            state.customers[i] = {...state.customers[i], name:document.getElementById('ed-name').value, phone:document.getElementById('ed-phone').value, notes:document.getElementById('ed-notes').value, vol:parseInt(document.getElementById('ed-vol').value)||0 };
            closeEditor(); renderCalendar();
        };

        // --- CORE SYNC ---
        window.saveDraft = (f, v) => { state.draft[f] = v; };
        window.handlePhotos = (input) => { Array.from(input.files).forEach(f => { const r = new FileReader(); r.onload = (e) => { state.images.push(e.target.result); const d = document.createElement('div'); d.className = 'gallery-item aspect-square rounded-xl overflow-hidden border border-white/10'; d.innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover">`; document.getElementById('photo-gallery').prepend(d); }; r.readAsDataURL(f); }); };
        window.handleSynchronize = () => {
            if(!state.draft.name) return showToast("NAME REQUIRED");
            state.customers.unshift({ id:Date.now().toString(), name:state.draft.name, phone:state.draft.phone, email:state.draft.email, date:state.draft.date||new Date().toISOString().split('T')[0], time:'08:20', vol:document.getElementById('cap-vol').value||0, notes:state.draft.notes });
            state.draft = {}; state.inventory = {}; state.images = []; document.getElementById('customer-form').reset(); switchTab('Dashboard');
        };

        window.renderCRM = () => { document.getElementById('crm-body').innerHTML = state.customers.map(c => `<div class="p-10 flex justify-between items-center cursor-pointer hover:bg-white/5" onclick="openEditor('${c.id}')"><p class="text-3xl font-black italic text-blue-400 uppercase">${c.name}</p><p class="font-bold text-zinc-600 uppercase">${c.vol} FT³ // ${c.date}</p></div>`).join(''); };
        window.changeMonth = (d) => { state.curMonth.setMonth(state.curMonth.getMonth()+d); renderCalendar(); };
        function updateStats() { let r = 0; state.customers.forEach(c => r += (parseInt(c.vol)||0)*2.5+250); document.getElementById('stat-rev').innerText = '$'+r.toLocaleString(); document.getElementById('stat-leads').innerText = state.customers.length; }
        window.showToast = (m) => { const t = document.getElementById('toast-msg'); t.innerText = m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 2000); };
        window.onload = () => switchTab('Dashboard');
    </script>
</body>
</html>

